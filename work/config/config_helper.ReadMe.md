# 字段介绍

## 名词约定
`字面量`: 指一个普通的数据，只有`值`的形式

`数据字段`: 指一个键值对，一般是`名称`: `值`的形式

`复合数据字段`: 指一个包含多个`值`的键值对

`不可变`: 指一个`键值对`的`名称`不可变，这是约定的名字

`可变`: 指一个`键值对`的`名称`可变，根据实际进行改变

`字面量集合`: 指一个容器用来储存`字面量`，解析为`vector`

`数据集合`: 指一个容器用来储存`数据字段`，解析为`map及其变体`

`复合数据集合`: 指一个容器用来储存`复合数据字段`，解析为`map及其变体`

`复合类型`: 指一个容器包含有`复数`个以上类型

## target 目标

### target 是一个`复合数据集合`，由`映射目标名`及`目标详细信息`组成
```json
{
  "target": {
	"target_name": {
	  "url": "http://banker.test.amnetapi.com/ade/v2/bankerServer/sync?platform=dsp",
	  "sum": true,
	  "field_replace": {
		"foo": "bar"
	  }
	}
  }
}
```
| 字段             | 描述                                    |
|:------------------ |:---------------------------------------------- |
| target`不可变`&`复合数据集合` | 目标的声明 |
| target_name`可变`&`复合数据字段`       | 仅起到区分作用，不参与实际过程                                    |
| url`不可变`&`数据字段`       | 数据要发送到的目标url            |
| sum`不可变`&`数据字段`      | 数据是否要求和(将原来统一类型不同维度的数据求和)          |
| field_replace`不可变`&`数据集合`   | 要替换名称的字段，为空表示不替换任何字段，以`原字段:目标字段`的形式加入，不存在的字段会被忽略      |

## source 源

### source 是一个`复合数据集合`，由`映射源名`，`映射源路径`以及`源字段解释详情`组成
```json
{
  "source": {
	"source_name": {
	  "path": {
		"/tmp/test_data/dsp_data/win/20210610": {
		  "start_time": {
			"year": 2021,
			"month_day": 610,
			"hour_minute": 1201
		  },
		  "filename_pattern": "win_(\\d{4}).log.cp.fp",
		  "type": "win",
		  "recursive": false
		},
		"/tmp/test_data/ftx_data/win/20210610": {
		  "start_time": {
			"year": 2021,
			"month_day": 610,
			"hour_minute": 1201
		  },
		  "filename_pattern": "win_(\\d{4}).log.cp.fp",
		  "type": "win",
		  "recursive": false
		}
	  },
	  "detail": {
		"code": {
		  "price": {
			"column": 7,
			"exclude": true,
			"values": []
		  }
		},
		"field": {
		  "ad": 3,
		  "ad_group": 4,
		  "campaign": 5,
		  "advertiser": 6,
		  "spot": 23
		},
		"layer": 26,
		"pad_data": "{\"pace_in\": [120,100,100,20,200,100,5],\"pace_out\": [0,0,0,0,200,150,150,10],\"request\": [100,100,100,100,100,100,100,100]}",
		"pad_field_name": [
		  "ad",
		  "spot"
		]
	  }
	}
  }
}
```
| 字段             | 描述                                    |
|:------------------ |:---------------------------------------------- |
| source`不可变`&`复合数据集合` | 源的声明 |
| source_name`可变`&`复合数据集合`       | 仅起到区分作用，不参与实际过程                                    |
| path`不可变`&`复合数据集合`       | path 里可以有多个源，只要他们的`源字段解释详情`是一样的，详细信息见下            |
| detail`不可变`&`复合数据集合`     | 该源中字段的解释方式，`一个映射源`只能有`一种源字段解释详情`，但是可以有多个不同的`映射源路径`，详细信息见下          |

#### path
| 字段             | 描述                                    |
|:------------------ |:---------------------------------------------- |
| /tmp/test_data/dsp_data/win/20210610`可变`&`复合数据集合`       | 一个`绝对路径`，详细信息见下            |
| /tmp/test_data/ftx_data/win/20210610`可变`&`复合数据集合`     | 一个`绝对路径`作用同上          |

#### detail
| 字段             | 描述                                    |
|:------------------ |:---------------------------------------------- |
| code`不可变`&`复合数据集合`       | 校验字段，详细信息见下           |
| field`不可变`&`数据集合`     | 数据的详情，以`数据字段`的形式插入，表示为`字段名称`: `字段所在的列`          |
| layer`不可变`&`数据字段`     | layer数据所在的列，必填并且要求合法(>0)          |
| pad_data`不可变`&`数据字段`     | 用于填充的数据，可以为空，如果不为空则必须可以解析为`JSON`          |
| pad_field_name`不可变`&`字面量集合`     | ，为空表示不填充任何字段，以`字段名`的形式加入，不存在的字段会被忽略         |

##### /tmp/test_data/dsp_data/win/20210610
| 字段             | 描述                                    |
|:------------------ |:---------------------------------------------- |
| start_time`不可变`&`数据集合`       | 目标问路径开始处理的时间，包含年月日，如果时间不合法(如负数时间，月+日组合不存在，时+分组合不存在)会跳过目标路径           |
| field`不可变`&`数据集合`     | 数据的详情，为空不计算任何数据，以`字段名`: `字段所在列`的形式加入          |
| filename_pattern`不可变`&`数据字段`     | 用于获取文件名中时间子串的正则表达式`模式串`，如果给予的模式串不正确，将会忽略所有数据甚至引发程序错误          |
| type`不可变`&`数据字段`     | 当前路径的文件所处理的类型，详情见`data_form_fwd.hpp->FILE_TYPE && data_form.hpp->BasicData::Increase`          |
| recursive`不可变`&`数据字段`     | 是否要递归寻找文件夹中的文件，注意，不会从子文件夹的名字中提取信息，所以如果子文件夹中的文件不符合`filename_pattern`则会引发错误         |

##### code
| 字段             | 描述                                    |
|:------------------ |:---------------------------------------------- |
| price`可变`&`复合数据字段`       | 用于校验的其中一个字段，用户可以指定任意多个校验字段，每个校验字段都必须合法           |
| price.column`不可变`&`数据字段`       | price是可变的，但是`column`是不可变的，每一个校验字段都必须含有这个字段，指出校验的字段所在的列           |
| price.exclude`不可变`&`数据字段`       | price是可变的，但是`exclude`是不可变的，每一个校验字段都必须含有这个字段，作用见下一个字段          |
| price.values`不可变`&`字面量集合`       | price是可变的，但是`values`是不可变的，每一个校验字段都必须含有这个字段，如果exclude为true，只有当column指定列的数据不存在于values中时校验才通过，如果exclude为false则只有当column指定列的数据存在与values中时校验才通过          |
